id: io.github.stedolan.jq
modules:
  - name: jq
    sources:
      - type: archive
        url: https://github.com/stedolan/jq/releases/download/jq-1.4/jq-1.4.tar.gz
        sha256: "0000000000000000000000000000000000000000000000000000000000000000"
        x-checker-data:
          type: json
          url: https://api.github.com/repos/stedolan/jq/releases/latest
          version-query: '.tag_name | sub("^jq-"; "")'
          url-query: '.assets[] | select(.name=="jq-" + $version + ".tar.gz") | .browser_download_url'
    modules:

      - name: oniguruma
        buildsystem: cmake-ninja
        sources:
          - type: git
            url: https://github.com/kkos/oniguruma.git
            tag: v6.9.4
            commit: e03900b038a274ee2f1341039e9003875c11e47d
            x-checker-data:
              type: json
              url: https://api.github.com/repos/kkos/oniguruma/releases/latest
              tag-query: '.tag_name'
              version-query: '$tag | sub("^[vV]"; "")'
              timestamp-query: '.published_at'

  - name: yasm
    sources:
      - type: git
        url: https://github.com/yasm/yasm.git
        x-checker-data:
          type: json
          url: https://api.github.com/repos/yasm/yasm/releases/latest
          tag-query: '.tag_name'
          version-query: '.tag_name | sub("^[vV]"; "")'

  - name: tdesktop
    sources:
      - type: git
        url: https://github.com/telegramdesktop/tdesktop.git
        tag: v2.6.0
        commit: 740ffb3c6426d62ac1a54e68d5a13f91479baf9a
        x-checker-data:
          type: json
          url: https://api.github.com/repos/telegramdesktop/tdesktop/releases/latest
          tag-query: '.tag_name'
          version-query: '.tag_name | sub("^[vV]"; "")'
          # This one should result in parse error
          timestamp-query: '.target_commitish'
